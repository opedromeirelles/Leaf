@model Leaf.Models.ViewModels.PedidoViewModel
@{
    ViewData["Title"] = "Detalhes do Pedido - Atualizar";
    var listaEntregadores = ViewData?["Entregadores"];
}

@if (TempData["MensagemErro"] != null)
{
    <span id="eventoErro" class="alert alert-danger">@TempData["MensagemErro"]</span>
}
else if (TempData["MensagemSucesso"] != null)
{
    <span id="eventoSucesso" class="alert alert-success">@TempData["MensagemSucesso"]</span>
}

<div class="container mt-5 mp-5 pl-5 mb-5" style="padding-left: 70px">
    <!-- Informações principais do pedido -->
    <input type="hidden" asp-for="IdPedido" />

    <div class="card shadow-sm">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <h3 class="card-title mb-0">Detalhes do Pedido #@Model.IdPedido</h3>
            <span class="badge badge-pill
                        @(Model.Pedido.Stauts == "EM" ? "badge-info" : Model.Pedido.Stauts == "BX" ? "badge-success" : Model.Pedido.Stauts == "CA" ? "badge-danger" : "badge-secondary")">
                @Model.Pedido.Stauts
            </span>
        </div>

        <div class="card-body">
            <!-- Sessão 1: Informações do Pedido -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card border-0">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-info-circle"></i> Informações do Pedido</h5>
                            <br />
                            <p><strong>Vendedor: </strong>@(@Model.Vendedor?.Nome ?? "Não atribuído")</p>
                            <p><strong>Data de Emissão: </strong>@(Model.Pedido?.DtaEmissao != null ? Model.Pedido.DtaEmissao?.ToString("dd/MM/yyyy") : "Data não disponível")</p>
                            
                            @if (Model.Pedido?.DtaSaida != null)
                            {
                                <p><strong>Data de Saída: </strong>@(Model.Pedido?.DtaSaida != null ? Model.Pedido.DtaSaida?.ToString("dd/MM/yyyy") : "Data não disponível")</p>
                            }

                            @if (Model.Pedido?.DtaEntrega != null)
                            {
                                <p><strong>Data da Entrega: </strong>@(Model.Pedido?.DtaEntrega != null ? Model.Pedido.DtaEntrega?.ToString("dd/MM/yyyy") : "Data não disponível")</p>
                            }

                            @if (Model.Pedido?.DtaCancelamento != null)
                            {
                                <p><strong>Data de Cancelamento: </strong>@(Model.Pedido?.DtaCancelamento != null ? Model.Pedido.DtaCancelamento?.ToString("dd/MM/yyyy") : "Data não disponível")</p>
                            }

                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <div class="card border-0">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-user"></i> Cliente</h5>
                            <br />
                            <p><strong>Nome: </strong>@(@Model.Cliente?.Nome ?? "Nome não disponível")</p>
                            @if (Model.Cliente?.Tipo == "PF")
                            {
                                <p><strong>CPF: </strong>@(@Model.Cliente?.Cpf ?? "CPF não disponível")</p>
                            }
                            else
                            {
                                <p><strong>CNPJ: </strong>@(@Model.Cliente?.Cnpj ?? "CNPJ não disponível")</p>
                            }
                            <p><strong>Telefone: </strong>@(@Model.Cliente?.Telefone1 ?? "Telefone não disponível")</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <div class="card border-0">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-truck"></i> Totais do Pedido</h5>
                            <br />
                            <p><strong>Valor Total:</strong> R$ @(Model.Pedido?.ValorToal != (decimal)0 ? Model.Pedido?.ValorToal.ToString("#,##0.00") : Model.ItensPedido.Sum(item => item.SubTotal).ToString("#,##0.00"))</p>
                            <p><strong>Total de itens:</strong> @(Model.ItensPedido != null ? Model.ItensPedido.Count : 0)</p>
                            <p><strong>Quantidade total:</strong> @(Model.ItensPedido != null ? Model.ItensPedido.Sum(item => item.Quantidade) : 0)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sessão 2: Lista de Produtos do Pedido -->
            <h5 class="mt-4"><i class="fas fa-boxes"></i> Itens do Pedido</h5>
            <div class="table-responsive mt-3">
                <table class="table table-hover table-bordered">
                    <thead class="bg-dark text-white">
                        <tr>
                            <th>Descrição</th>
                            <th>Quantidade</th>
                            <th>Valor Unitário</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model?.ItensPedido != null && Model.ItensPedido.Any())
                        {
                            foreach (var item in Model.ItensPedido)
                            {
                                <tr>
                                    <td>@(item.Produto?.Descricao ?? "Produto não encontrado")</td>
                                    <td>@item.Quantidade</td>
                                    <td>R$ @item.Produto?.ValorUnitario.ToString("#,##0.00")</td>
                                    <td>R$ @item.SubTotal.ToString("#,##0.00")</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3" class="text-center">Nenhum item encontrado.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Botões de Controle -->
        <div class="text-right m-3">
            <a href="@Url.Action("Index", "RelatorioEntregas")" class="btn btn-outline-secondary"><i class="fas fa-times"></i> Voltar</a>
        </div>
        <br />
    </div>
</div>

<script src="https://kit.fontawesome.com/a076d05399.js"></script>
